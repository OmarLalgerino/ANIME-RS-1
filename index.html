<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>مشغل أنمي تورنت - OmarL</title>
    <script src="https://cdn.jsdelivr.net/npm/webtorrent@latest/webtorrent.min.js"></script>
    <style>
        body { font-family: sans-serif; background-color: #1a1a1a; color: white; text-align: center; padding: 20px; }
        .anime-card { background: #333; margin: 10px; padding: 15px; border-radius: 8px; display: inline-block; width: 250px; vertical-align: top; }
        .anime-card img { width: 100%; border-radius: 5px; height: 300px; object-fit: cover; }
        .btn-group button { margin: 5px; padding: 8px 15px; cursor: pointer; border: none; border-radius: 4px; background: #e91e63; color: white; }
        #player-container { margin-top: 20px; position: sticky; top: 10px; z-index: 100; }
        video { width: 90%; max-width: 800px; border: 2px solid #e91e63; border-radius: 10px; background: black; }
        #status { color: #ffeb3b; margin: 10px; }
    </style>
</head>
<body>

    <h1>قائمة الأنمي (بث تورنت)</h1>
    <div id="player-container"></div>
    <div id="status"></div>
    <div id="anime-list">جاري تحميل البيانات...</div>

    <script>
        const client = new WebTorrent();
        const jsonUrl = "https://raw.githubusercontent.com/OmarLalgerino/anime-RS-/refs/heads/main/data.json?token=GHSAT0AAAAAADTOOC76T5A7HMIPLO6X4NIU2L5DRVQ";

        // 1. جلب البيانات من رابط الـ Raw الخاص بك
        fetch(jsonUrl)
            .then(response => response.json())
            .then(data => {
                const listContainer = document.getElementById('anime-list');
                listContainer.innerHTML = ''; // مسح رسالة التحميل

                data.forEach(anime => {
                    const card = document.createElement('div');
                    card.className = 'anime-card';
                    
                    // استخدام البوستر من الملف أو صورة افتراضية
                    const poster = anime.info.poster.includes('placeholder') ? 'https://via.placeholder.com/250x350?text=No+Image' : anime.info.poster;

                    card.innerHTML = `
                        <img src="${poster}" alt="${anime.title}">
                        <h3>${anime.title}</h3>
                        <div class="btn-group">
                            ${anime.links["1080p"] ? `<button onclick="playVideo('${anime.links["1080p"]}')">1080p</button>` : ''}
                            ${anime.links["480p"] ? `<button onclick="playVideo('${anime.links["480p"]}')">480p</button>` : ''}
                        </div>
                    `;
                    listContainer.appendChild(card);
                });
            })
            .catch(err => {
                document.getElementById('anime-list').innerHTML = "خطأ في جلب البيانات. تأكد من صلاحية الـ Token.";
                console.error(err);
            });

        // 2. دالة تشغيل التورنت
        function playVideo(torrentId) {
            const status = document.getElementById('status');
            const playerContainer = document.getElementById('player-container');
            
            status.innerHTML = "جاري الاتصال بالموزعين (Seeders)... يرجى الانتظار";
            playerContainer.innerHTML = ''; // تنظيف المشغل القديم

            client.add(torrentId, function (torrent) {
                // البحث عن أول ملف فيديو داخل التورنت
                const file = torrent.files.find(f => f.name.endsWith('.mp4') || f.name.endsWith('.mkv'));
                
                if (file) {
                    status.innerHTML = `جاري الآن تشغيل: ${file.name}`;
                    file.appendTo('#player-container', { autoplay: true, controls: true });
                } else {
                    status.innerHTML = "لم يتم العثور على ملف فيديو داخل التورنت.";
                }
            });
        }
    </script>
</body>
</html>
